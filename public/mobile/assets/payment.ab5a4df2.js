import{by as e,bz as r,bA as a,aD as n,W as o,ay as s,Z as i,bB as t}from"./index-81cd8d96.js";function u(){const u=async(a,n)=>{try{switch(n.pay_way){case 1:await(async a=>{await e({MP_WEIXIN:()=>new Promise(((e,r)=>{console.log(a,"weixin"),uni.requestPayment({provider:"wxpay",timeStamp:null==a?void 0:a.timeStamp,nonceStr:null==a?void 0:a.nonceStr,package:null==a?void 0:a.package,signType:null==a?void 0:a.signType,paySign:null==a?void 0:a.paySign,success:r=>e(r),fail:e=>r(e)})})),OA_WEIXIN:()=>r(a),H5:()=>new Promise(((e,r)=>{window.open(a,"_self"),e()})),APP:()=>new Promise(((e,r)=>{uni.requestPayment({provider:"wxpay",orderInfo:a,success:r=>e(r),cancel:e=>r(e),fail:e=>r(e)})}))})})(a.config);break;case 2:await(async r=>{await e({H5:()=>new Promise(((e,a)=>{const n=window.open("","_self");n.document.body.innerHTML=r,n.document.forms[0].submit(),e()})),APP:()=>new Promise(((e,a)=>{uni.requestPayment({provider:"alipay",orderInfo:r,success:r=>e("success"),cancel:e=>a("fail"),fail:e=>a("fail")})})),MP_TOUTIAO:()=>(console.log(r),new Promise(((e,a)=>{uni.requestPayment({provider:"alipay",orderInfo:r,service:1,success:r=>e(r),cancel:e=>a(e),fail:e=>a(e)})})))})})(a.config);break;default:uni.$u.toast("支付异常")}const o=JSON.stringify({order_id:n.order_id,from:n.from});if("recharge"===n.from)return i({url:"/bundle/pages/user_wallet/user_wallet?isPay=true"});i({url:`/bundle/pages/payment_result/payment_result?param=${o}`})}catch(o){if("order"===n.from&&i({url:"/pages/order/index"}),0==Number(n.order_amount))return uni.$u.toast("下单成功");uni.$u.toast("支付取消")}};return{initPayWay:async e=>{try{return await a({from:e.from||"order",order_id:e.order_id,scene:n()})}catch(r){console.log("获取支付方式",r)}},handlePayPrepay:async e=>{try{if(o().userInfo.pay_auth&&1==e.pay_way)return void s({content:"当前账号未微信授权，请前往个人设置授权",confirmText:"前往授权",success:function(e){e.confirm&&i({url:"/pages/user_set/user_set"})}});const r=await t({from:e.from||"order",pay_way:e.pay_way,order_id:e.order_id}),a=JSON.stringify({order_id:e.order_id,from:e.from});3!==e.pay_way?u(r,e):(i({url:`/bundle/pages/payment_result/payment_result?param=${a}`}),uni.$u.toast("支付成功"))}catch(r){uni.$u.toast(r)}},handlePay:u}}export{u};
