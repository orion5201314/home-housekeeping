import{d as e,q as t,s as a,o as l,c as s,w as r,g as o,l as u,k as i,v as d,x as n,F as c,az as m,i as p,U as f,m as x,a8 as v,e as _,f as y,A as w,t as g,G as b,aA as h,D as k,X as j,a1 as C,aB as $,a3 as V,j as D,n as z,ay as F,a4 as S,a6 as M,Z as P,aC as U,aD as A,P as E,aE as I}from"./index-81cd8d96.js";import{_ as N}from"./page-meta.31474f74.js";import{_ as T}from"./u-icon.1e505d03.js";import{_ as W}from"./u-image.b1460259.js";import{_ as H}from"./u-number-box.b3630022.js";import{_ as L}from"./u-input.241f466f.js";import{_ as J,a as O}from"./u-radio-group.e2593039.js";import{_ as Z}from"./u-popup.0f1c5899.js";import{b as q,c as B}from"./order.8140439c.js";import{P as G}from"./index.d91419a7.js";import{u as Q}from"./payment.ab5a4df2.js";import{t as R}from"./util.4309b5a4.js";import{_ as X}from"./_plugin-vue_export-helper.1b428a4d.js";import{c as Y}from"./goods.c5f169af.js";import"./emitter.1571a5d9.js";const K=X(e({__name:"appoint_time",props:{data:{default:{}}},setup(e,{expose:b}){const h=e,k=t(!1),j=t([]),C=t(0),$=t(),V=t(),D=t([]),z=t(!1),F=(e,t)=>{if(void 0!==e&&D.value[e].disabled)return R("该时间不可预约");$.value=e,C.value=t;const a=j.value[C.value];V.value={year:a.year,month:a.month,week:a.week,day:a.day,appoint_time:h.data.appoint_time[$.value]}},S=(e,t)=>0===t?"今天":1===t?"明天":0===e?"周日":1===e?"周一":2===e?"周二":3===e?"周三":4===e?"周四":5===e?"周五":6===e?"周六":void 0,M=()=>{V.value?(m("appointTime",V.value),k.value=!1):R("请选择服务时间")};b({open:()=>{k.value=!0}});const P=()=>{if(0===C.value){const e=new Date,t=e.getMinutes(),a=e.getHours()+""+(t<=9?"0"+t:t);z.value=!0,D.value.map((e=>{const t=e.time.replace(":","");e.disabled=Number(t)-(Number(a)+100)<0,e.disabled||(z.value=!1)}))}else z.value=!1,D.value.map((e=>{e.disabled=!1}))};return a((()=>h.data),(e=>{j.value=(e=>{const t=[],a=(new Date).getTime();for(let l=0;l<e;l++){const e=a+24*l*60*60*1e3,s=new Date(e).getFullYear(),r=new Date(e).getMonth()+1,o=new Date(e).getDay(),u=new Date(e).getDate();t.push({year:s,month:r,day:u,week:S(o,l),date:(r<=9?"0"+r:r)+"-"+(u<=9?"0"+u:u)})}return t})(e.advance_reservation_time);for(const t in e.appoint_time)D.value.push({time:e.appoint_time[t],disabled:!1});P()}),{immediate:!0}),a((()=>C.value),(e=>{P()}),{immediate:!0,deep:!0}),(e,t)=>{const a=p,m=f,b=x,h=v,V=_(y("u-popup"),Z);return l(),s(a,null,{default:r((()=>[o(V,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),mode:"bottom","border-radius":"14",closeable:!0},{default:r((()=>[u(" Header Start "),o(a,{class:"font-bold mt-[20rpx] mb-[20rpx] text-center text-3xl"},{default:r((()=>[i("选择服务时间")])),_:1}),o(m,{class:"scroll-view-box","scroll-x":"true"},{default:r((()=>[(l(!0),d(c,null,n(j.value,((e,t)=>(l(),s(a,{key:t,class:w(["day text-base",{active:C.value==t}]),onClick:e=>F(void 0,t)},{default:r((()=>[o(a,null,{default:r((()=>[i(g(e.week),1)])),_:2},1024),o(a,{class:"mt-[10rpx]"},{default:r((()=>[i(g(e.date),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(" Header End "),u(" Main Start "),o(m,{"scroll-y":"true",class:"h-[900rpx] bg-[#edf1f3]"},{default:r((()=>[z.value?(l(),s(a,{key:1,class:"flex justify-center items-center h-[600rpx]"},{default:r((()=>[o(b,{class:"text-muted"},{default:r((()=>[i("今日暂无可用时间段")])),_:1})])),_:1})):(l(),s(a,{key:0,class:"time-box flex flex-wrap"},{default:r((()=>[(l(!0),d(c,null,n(D.value,((e,t)=>(l(),d(c,{key:t},[e.disabled?u("v-if",!0):(l(),s(a,{key:0,class:w(["time-item",{select:$.value==t,disabled:e.disabled}]),onClick:e=>F(t,C.value)},{default:r((()=>[o(a,{class:"font-bold w-full"},{default:r((()=>[i(g(e.time),1)])),_:2},1024),e.disabled?(l(),s(a,{key:0,class:"text-[20rpx] w-full"},{default:r((()=>[i("不可预约")])),_:1})):u("v-if",!0)])),_:2},1032,["class","onClick"]))],64)))),128))])),_:1})),o(a,{class:"h-[190rpx]"})])),_:1}),u(" Main End "),u(" Footer Start "),o(a,{class:"footer"},{default:r((()=>[o(h,{class:"bg-primary text-lg text-white leading-[80rpx] h-[80rpx]",onClick:M},{default:r((()=>[i(" 确定 ")])),_:1})])),_:1}),u(" Footer End ")])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-3f692ee9"]]),ee=X(e({__name:"index",setup(e){const{initPayWay:a,handlePayPrepay:m}=Q(),f=t({address:[],goods:[],order_amount:"",total_amount:"",total_goods_price:""}),w=t(""),R=t("");let X=b({goods_num:1,id:0,sku_id:0});const ee=h(),te=t(""),ae=t({}),le=k(),se=t({});t({});const re=t(),oe=t(),ue=t(!1),ie=t(""),de=t(""),ne=async(e="")=>{var t;const a={action:"settlement",goods:X,address_id:e};f.value=await q({...a}),R.value=null==(t=f.value.address)?void 0:t.id},ce=()=>{le.value.open()},me=()=>{f.value.order_amount=(f.value.goods.price*X.goods_num).toFixed(2)},pe=async()=>R.value?te.value?re.value?void F({title:"温馨提示",content:"是否确认下单支付？",success:async function(e){e.confirm&&fe()}}):uni.$u.toast("请先去选择支付方式"):uni.$u.toast("请先去选择服务时间"):uni.$u.toast("请先去选择地址"),fe=async()=>{S({title:"订单提交中...",mask:!0});const e={action:"submit",appoint_time:`${ae.value.year}-${ae.value.month}-${ae.value.day} ${ae.value.appoint_time}`,goods:X,address_id:R.value,user_remark:w.value,pay_way:re.value};try{const t=await q({...e});if(de.value=t.order_id,M(),2==re.value){if(navigator.userAgent.toLowerCase().match(/MicroMessenger/i))return void P({url:`/bundle/pages/toAlipay/toAlipay?order_id=${t.order_id}&from=${t.type}&pay_way=${re.value}&key=${ee}`})}m({from:t.type,pay_way:re.value,order_id:t.order_id})}catch(t){console.log("下单",t)}};function xe(){const e=JSON.stringify({order_id:de.value,from:"order"});P({url:`/bundle/pages/payment_result/payment_result?param=${e}`})}return j((async e=>{const{goodsData:t}=JSON.parse(e.params);X.goods_num=parseInt(t.goods_num),X.id=parseInt(t.id),X.sku_id=parseInt(t.sku_id),ne(),(async()=>{const e=await B({from:"order",scene:A()});for(var t in oe.value=e,e)1==e[t].is_default&&(re.value=e[t].pay_way)})(),(async()=>{se.value=await Y({sku_id:X.sku_id})})(),C("appointTime",(e=>{console.log(e),ae.value=e,te.value=e.month+"-"+e.day+" ("+e.week+") "+e.appoint_time})),C("address",(e=>{R.value=e,ne(e)}))})),$((()=>{V(["appointTime","address"])})),(e,t)=>{const a=_(y("page-meta"),N),m=p,b=_(y("u-icon"),T),h=x,k=_(y("u-image"),W),j=_(y("u-number-box"),H),C=_(y("u-input"),L),$=_(y("u-radio"),J),V=I,F=_(y("u-radio-group"),O),S=v,M=_(y("u-popup"),Z);return l(),d(c,null,[o(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),o(m,{class:"order_buy"},{default:r((()=>[u(" 地址卡片 "),o(m,{class:"card"},{default:r((()=>[o(m,{class:"card--address",onClick:t[0]||(t[0]=e=>{return t="/bundle/pages/user_address/index?type=true&goods_id="+D(X).id,void E({url:t});var t})},{default:r((()=>[o(m,{class:"flex justify-between"},{default:r((()=>[0===f.value.address.length?(l(),s(m,{key:0,class:"title pt-[20rpx]"},{default:r((()=>[i("请选择地址")])),_:1})):(l(),s(m,{key:1,class:"title"},{default:r((()=>[i(g(f.value.address.province)+" "+g(f.value.address.city)+" "+g(f.value.address.district)+" "+g(f.value.address.address),1)])),_:1})),o(b,{name:"arrow-right",color:"#707070",size:"22"})])),_:1}),f.value.address.length?u("v-if",!0):(l(),s(m,{key:0,class:"text-sm text-muted mt-[10rpx]"},{default:r((()=>{var e,t,a;return[i(g(null==(e=f.value.address)?void 0:e.contact)+" "+g(null==(t=f.value.address)?void 0:t.sex_desc)+" "+g(null==(a=f.value.address)?void 0:a.mobile),1)]})),_:1}))])),_:1}),u(' <view\n                class="u-flex justify-between mt-[30rpx] mb-[10rpx]"\n            >\n                <view class="normal text-base font-medium">服务人员</view>\n                <view class="u-flex">\n\t\t\t\t\t<text class="mr-[10rpx] text-sm text-black text-[#909399]" v-if="staff.length == 0">请选择服务人员</text>\n                    <view v-else class="u-flex">\n\t\t\t\t\t\t<u-image width="50rpx" height="50rpx" shape="circle" :src="staff.avatar"></u-image>\n\t\t\t\t\t\t<text class="mr-[10rpx] ml-[10rpx] text-sm text-black">{{ staff.name }}</text>\n\t\t\t\t\t</view>\n                    <u-icon name="arrow-right" color="#707070" size="22"></u-icon>\n                </view>\n            </view> '),o(m,{class:"u-flex justify-between mt-[30rpx] mb-[10rpx]",onClick:ce},{default:r((()=>[o(m,{class:"normal text-base font-medium"},{default:r((()=>[i("服务时间")])),_:1}),o(m,{class:"u-flex"},{default:r((()=>[te.value.length>0?(l(),s(h,{key:0,class:"mr-[10rpx] text-sm text-black",style:z({color:e.$theme.primaryColor})},{default:r((()=>[i(g(te.value),1)])),_:1},8,["style"])):(l(),s(h,{key:1,class:"mr-[10rpx] text-sm text-black text-[#909399]"},{default:r((()=>[i("请选择服务时间")])),_:1})),o(b,{name:"arrow-right",color:"#707070",size:"22"})])),_:1})])),_:1})])),_:1}),u(" 商品卡片 "),o(m,{class:"card"},{default:r((()=>[o(m,{class:"goods-item"},{default:r((()=>[o(k,{src:f.value.goods.image,width:"160",height:"160","border-radius":"16"},null,8,["src"]),o(m,{class:"ml-[20rpx] w-[480rpx] goods-item--info"},{default:r((()=>{var e;return[o(m,{class:"flex-1 truncate font-bold"},{default:r((()=>[i(g(f.value.goods.name),1)])),_:1}),(null==(e=f.value.goods)?void 0:e.label)?(l(),s(m,{key:0,class:"u-flex flex-wrap text-[#707070] text-[24rpx]"},{default:r((()=>[(l(!0),d(c,null,n(f.value.goods.label,((e,t)=>(l(),s(h,{class:"tag",key:t},{default:r((()=>[i(g(e),1)])),_:2},1024)))),128))])),_:1})):u("v-if",!0),o(m,{class:"mt-[30rpx] u-flex justify-between foot"},{default:r((()=>[o(G,{price:f.value.goods.price,priceFontSize:"36rpx"},null,8,["price"]),o(j,{modelValue:D(X).goods_num,"onUpdate:modelValue":t[1]||(t[1]=e=>D(X).goods_num=e),min:1,"input-width":60,"bg-color":"#ffffff",onChange:me},null,8,["modelValue"])])),_:1})]})),_:1})])),_:1}),u(' <view\n\t\t\t    class="u-flex justify-between mt-[40rpx] mb-[10rpx]"\n\t\t\t>\n\t\t\t    <view class="normal text-base font-medium">优惠券</view>\n\t\t\t    <view class="u-flex">\n\t\t\t        <text class="mr-[10rpx] text-sm text-black text-[#909399]">请选择优惠券</text>\n\t\t\t        <u-icon name="arrow-right" color="#707070" size="22"></u-icon>\n\t\t\t    </view>\n\t\t\t</view> ')])),_:1}),u(" 备注 "),o(m,{class:"card"},{default:r((()=>[o(m,{class:"normal text-lg font-medium"},{default:r((()=>[i("订单备注")])),_:1}),o(m,{class:"mt-[10rpx]"},{default:r((()=>[o(C,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),type:"textarea",placeholder:"请输入备注信息",height:"124"},null,8,["modelValue"])])),_:1})])),_:1}),u(" 支付方式 "),o(m,{class:"card"},{default:r((()=>[o(m,{class:"font-bold text-2xl mb-[20rpx]"},{default:r((()=>[i("支付方式")])),_:1}),o(m,null,{default:r((()=>[u(' <radio-group>\n\t\t\t        <view\n\t\t\t            v-for="item in payWayList"\n\t\t\t            :key="item.id"\n\t\t\t            class="pt-[10rpx] pb-[10rpx] mb-[20rpx]"\n\t\t\t            @click="selectPayWay(item.pay_way)"\n\t\t\t        >\n\t\t\t            <label>\n\t\t\t                <view class="flex justify-between items-center">\n\t\t\t                    <view class="flex items-center justify-between w-full">\n\t\t\t                        <view class="flex items-center">\n\t\t\t                            <u-image :src="item.image" width="36" height="36" shape="circle" />\n\t\t\t                            <view class="pl-[20rpx] u-flex">\n\t\t\t                                <view class="text-[28rpx] text-[#333]">{{ item.name }}</view>\n\t\t\t                                <view class="pl-[10rpx] text-[24rpx] text-muted">\n\t\t\t                                    {{ item.extra || \'\' }}\n\t\t\t                                </view>\n\t\t\t                            </view>\n\t\t\t                        </view>\n\t\t\t                        <view>\n\t\t\t                            <radio\n\t\t\t                                :color="$theme.primaryColor"\n\t\t\t                                :value="item.pay_way"\n\t\t\t                                :checked="item.pay_way === payWay"\n\t\t\t\t\t\t\t\t\t\t\tstyle="transform:scale(0.7)"\n\t\t\t                            />\n\t\t\t                        </view>\n\t\t\t                    </view>\n\t\t\t                </view>\n\t\t\t            </label>\n\t\t\t        </view>\n\t\t\t    </radio-group> '),(l(),s(F,{modelValue:re.value,"onUpdate:modelValue":t[3]||(t[3]=e=>re.value=e),key:re.value,class:"w-full","active-color":e.$theme.primaryColor},{default:r((()=>[(l(!0),d(c,null,n(oe.value,(e=>(l(),s(m,{key:e.id,class:"pt-[10rpx] pb-[10rpx] mb-[20rpx] w-full",onClick:t=>{return a=e.pay_way,void(re.value=a);var a}},{default:r((()=>[o(V,null,{default:r((()=>[o(m,{class:"flex justify-between items-center"},{default:r((()=>[o(m,{class:"flex items-center justify-between w-full"},{default:r((()=>[o(m,{class:"flex items-center"},{default:r((()=>[o(k,{src:e.image,width:"36",height:"36",shape:"circle"},null,8,["src"]),o(m,{class:"pl-[20rpx] u-flex"},{default:r((()=>[o(m,{class:"text-[28rpx] text-[#333]"},{default:r((()=>[i(g(e.name),1)])),_:2},1024),o(m,{class:"pl-[10rpx] text-[24rpx] text-muted"},{default:r((()=>[i(g(e.extra||""),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(m,null,{default:r((()=>[o($,{name:e.pay_way},null,8,["name"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","active-color"]))])),_:1})])),_:1}),u(" Footer Start "),o(m,{class:"footer flex justify-between items-center"},{default:r((()=>[o(m,null,{default:r((()=>[o(h,{class:"text-base"},{default:r((()=>[i("总计：")])),_:1}),o(h,{class:"text-base",style:z({color:e.$theme.primaryColor})},{default:r((()=>[i("¥")])),_:1},8,["style"]),o(h,{class:"font-medium text-4xl",style:z({color:e.$theme.primaryColor})},{default:r((()=>[i(g(f.value.order_amount),1)])),_:1},8,["style"])])),_:1}),o(m,{class:"btn"},{default:r((()=>[o(S,{class:"bg-primary text-lg text-white leading-[80rpx] h-[80rpx]",onClick:pe},{default:r((()=>[i(" 立即支付 ")])),_:1})])),_:1})])),_:1}),u(" Footer End "),u(" 服务时间弹窗 "),o(K,{ref_key:"appointTimeRef",ref:le,data:se.value},null,8,["data"]),u(" 支付宝支付弹窗 "),o(M,{modelValue:ue.value,"onUpdate:modelValue":t[5]||(t[5]=e=>ue.value=e),mode:"bottom",height:"600rpx","safe-area-inset-bottom":"","border-radius":"20",closeable:"",onClose:xe},{default:r((()=>[o(m,{style:{padding:"60rpx 30rpx",display:"flex","justify-content":"center","align-items":"center","flex-direction":"column"}},{default:r((()=>[o(m,{style:{"font-size":"50rpx",margin:"10rpx 0 20rpx"}},{default:r((()=>[i("￥"+g(f.value.order_amount),1)])),_:1}),o(m,{class:"flex row-between m-t-50",style:{width:"100%","justify-content":"space-between","font-weight":"bold"}},{default:r((()=>[o(h,{class:"bold"},{default:r((()=>[i("支付方式")])),_:1}),o(h,{class:"bold"},{default:r((()=>[i("支付宝")])),_:1})])),_:1}),o(m,{class:"p-20 m-t-50 m-b-50",style:{width:"100%","background-color":"#9e9e9e40",padding:"15rpx 15rpx",margin:"50rpx 0"}},{default:r((()=>[i("请复制链接,粘贴至浏览器并支付")])),_:1}),o(S,{onClick:t[4]||(t[4]=e=>{U({data:ie.value})}),style:z({"border-radius":"12rpx",width:"100%",height:"80rpx","line-height":"80rpx","font-size":"28rpx",color:"white","background-color":e.$theme.primaryColor})},{default:r((()=>[i("复制链接")])),_:1},8,["style"])])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-689a8aad"]]);export{ee as default};
