import{o as e,c as t,n as l,i as r,d as a,q as o,w as d,l as s,V as i,k as n,v as u,g as p,F as c,x as f,t as x,a8 as m,m as _,e as y,f as b,U as g,P as h,ay as v,a4 as w,a6 as k}from"./index-81cd8d96.js";import{_ as C}from"./u-number-box.b3630022.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as V}from"./u-popup.0f1c5899.js";import{_ as S}from"./u-input.241f466f.js";import{e as $,f as j,g as B}from"./order.8140439c.js";import{d as U}from"./goods.c5f169af.js";const L=I({name:"u-line",props:{color:{type:String,default:"#e4e7ed"},length:{type:String,default:"100%"},direction:{type:String,default:"row"},hairLine:{type:Boolean,default:!0},margin:{type:String,default:"0"},borderStyle:{type:String,default:"solid"}},computed:{lineStyle(){let e={};return e.margin=this.margin,"row"==this.direction?(e.borderBottomWidth="1px",e.borderBottomStyle=this.borderStyle,e.width=this.$u.addUnit(this.length),this.hairLine&&(e.transform="scaleY(0.5)")):(e.borderLeftWidth="1px",e.borderLeftStyle=this.borderStyle,e.height=this.$u.addUnit(this.length),this.hairLine&&(e.transform="scaleX(0.5)")),e.borderColor=this.color,e}}},[["render",function(a,o,d,s,i,n){const u=r;return e(),t(u,{class:"u-line",style:l([n.lineStyle])},null,8,["style"])}],["__scopeId","data-v-7e367c12"]]),z=I(a({__name:"index",props:{orderId:{default:""},orderGoodsId:{default:""},goodsId:{default:""},orderBtn:{default:{}}},emits:["refresh","backRefresh"],setup(a,{emit:I}){const z=a,G=o(!1),A=o(""),E=o(!1),F=o(""),W=o([]),q=e=>{h({url:e})},N=()=>{h({url:`/bundle/pages/order_pay/order_pay?order_id=${z.orderId}&from=order`})},O=()=>{if(!A.value)return uni.$u.toast("请输入差价金额");v({title:"温馨提示",content:"是否确认支付？",success:async e=>{if(e.confirm)try{const e=await j({id:z.orderId,difference_price:A.value});h({url:`/bundle/pages/order_pay/order_pay?order_id=${e.order_id}&from=${e.type}`})}catch(t){console.log("补差价",t)}}})},P=async()=>{0===W.value.length&&await Y(),E.value=!0},R=()=>{if(!F.value)return uni.$u.toast("请选择需要加的项目");v({title:"温馨提示",content:"是否确认支付？",success:async e=>{if(e.confirm)try{const e=await B({id:z.orderId,additional_info:W.value});h({url:`/bundle/pages/order_pay/order_pay?order_id=${e.order_id}&from=${e.type}`})}catch(t){console.log("加项",t)}}})},X=(e,t)=>{let l=0;W.value.forEach((function(e,t){l+=e.price*e.num})),F.value=l.toFixed(2)},Y=async()=>{(await U({goods_id:z.goodsId})).forEach((function(e,t){e.num=0,W.value.push(e)}))};return(o,h)=>{const j=m,B=r,U=_,Y=y(b("u-number-box"),C),D=g,H=y(b("u-line"),L),J=y(b("u-popup"),V),K=y(b("u-input"),S);return e(),t(B,{class:"flex"},{default:d((()=>[s(" 取消订单 "),a.orderBtn.cancel_btn?(e(),t(j,{key:0,class:"bg-white ml-[20rpx] h-[60rpx] leading-[60rpx] text-base",style:{border:"solid 1rpx #c8c9cc"},onClick:h[0]||(h[0]=i((e=>(async()=>{if(!(await v({title:"温馨提示",content:"确认取消该订单吗？"})).cancel){try{w({title:"订单取消中"}),await $({id:z.orderId}),k()}catch(e){console.log("错误信息：",e,z.orderId)}I("refresh")}})(a.orderId)),["stop"]))},{default:d((()=>[n(" 取消订单 ")])),_:1})):s("v-if",!0),s(" 去支付 "),a.orderBtn.pay_btn?(e(),t(j,{key:1,class:"bg-warning ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:i(N,["stop"])},{default:d((()=>[n(" 立即支付 ")])),_:1},8,["onClick"])):s("v-if",!0),s(" 加项 "),a.orderBtn.additional_btn?(e(),u(c,{key:2},[p(j,{class:"bg-warning ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:i(P,["stop"])},{default:d((()=>[n(" 加项 ")])),_:1},8,["onClick"]),p(J,{modelValue:E.value,"onUpdate:modelValue":h[1]||(h[1]=e=>E.value=e),closeable:!0,mode:"center",maskCloseAble:!1,"border-radius":"20",zoom:!1},{default:d((()=>[p(B,{class:"px-[30rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:d((()=>[p(B,{class:"mb-[70rpx] text-xl text-center"},{default:d((()=>[n("加项")])),_:1}),p(B,null,{default:d((()=>[p(D,{"scroll-y":"true",style:{height:"380rpx"}},{default:d((()=>[(e(!0),u(c,null,f(W.value,(r=>(e(),t(B,{class:"bg-[#edf1f3] u-flex justify-between mb-[20rpx]",style:{"border-radius":"16rpx",padding:"30rpx 20rpx"},key:r.id},{default:d((()=>[p(B,{class:"u-flex-1 w-[100rpx]"},{default:d((()=>[p(B,{class:"truncate"},{default:d((()=>[n(x(r.name),1)])),_:2},1024),p(B,{class:"text-sm mt-[6rpx]"},{default:d((()=>[p(U,{style:l({color:o.$theme.primaryColor})},{default:d((()=>[n("￥"+x(r.price),1)])),_:2},1032,["style"]),p(U,null,{default:d((()=>[n("/"+x(r.duration)+"分钟",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(B,null,{default:d((()=>[p(Y,{modelValue:r.num,"onUpdate:modelValue":e=>r.num=e,"input-width":60,"bg-color":"#edf1f3",onChange:X},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),p(B,{class:"popup-footer"},{default:d((()=>[p(B,{class:"text-[24rpx] text-muted mt-[30rpx]"},{default:d((()=>[n("*支付前需与服务人员协商一致，如有异议，请联系平台客服。系统只保障在线支付的项目，切勿线下支付。")])),_:1}),p(H,{color:"#f4f4f5",margin:"30rpx 0"}),p(B,{class:"u-flex justify-between"},{default:d((()=>[p(B,null,{default:d((()=>[p(U,{class:"text-muted"},{default:d((()=>[n("总计：")])),_:1}),p(U,{style:l({color:o.$theme.primaryColor})},{default:d((()=>[n("￥"+x(F.value),1)])),_:1},8,["style"])])),_:1}),p(B,null,{default:d((()=>[p(j,{class:"bg-primary ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:i(R,["stop"])},{default:d((()=>[n(" 立即支付 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)):s("v-if",!0),s(" 补差价 "),a.orderBtn.difference_price_btn?(e(),u(c,{key:3},[p(j,{class:"bg-primary ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:h[2]||(h[2]=i((e=>G.value=!0),["stop"]))},{default:d((()=>[n(" 补差价 ")])),_:1}),p(J,{modelValue:G.value,"onUpdate:modelValue":h[4]||(h[4]=e=>G.value=e),closeable:!0,mode:"center",maskCloseAble:!1,"border-radius":"20",zoom:!1},{default:d((()=>[p(B,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:d((()=>[p(B,{class:"mb-[70rpx] text-xl text-center"},{default:d((()=>[n("补差价")])),_:1}),p(B,{style:{position:"relative",height:"90rpx"}},{default:d((()=>[p(B,{style:{position:"absolute",left:"20rpx",top:"26rpx","z-index":"1"}},{default:d((()=>[n("补差价金额")])),_:1}),p(K,{class:"bg-[#edf1f3]",style:{padding:"10rpx 20rpx 10rpx 190rpx","border-radius":"12rpx",position:"absolute"},modelValue:A.value,"onUpdate:modelValue":h[3]||(h[3]=e=>A.value=e),clearable:!1,"input-align":"right",placeholder:"￥0.00",type:"digit"},null,8,["modelValue"])])),_:1}),p(B,{class:"popup-footer"},{default:d((()=>[p(B,{class:"text-[24rpx] text-muted mt-[30rpx]"},{default:d((()=>[n("*支付前需与服务人员协商一致，如有异议，请联系平台客服。系统只保障在线支付的项目，切勿线下支付。")])),_:1}),p(H,{color:"#f4f4f5",margin:"30rpx 0"}),p(B,{class:"u-flex justify-between"},{default:d((()=>[p(B,null,{default:d((()=>[p(U,{class:"text-muted"},{default:d((()=>[n("总计：")])),_:1}),p(U,{style:l({color:o.$theme.primaryColor})},{default:d((()=>[n("￥"+x(A.value),1)])),_:1},8,["style"])])),_:1}),p(B,null,{default:d((()=>[p(j,{class:"bg-primary ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:i(O,["stop"])},{default:d((()=>[n(" 立即支付 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)):s("v-if",!0),s(" 去评价 "),a.orderBtn.comment_btn?(e(),t(j,{key:4,class:"bg-warning ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:h[5]||(h[5]=i((e=>q("/bundle/pages/evaluate_submit/index?order_goods_id="+a.orderGoodsId)),["stop"]))},{default:d((()=>[n(" 去评价 ")])),_:1})):s("v-if",!0),s(" 查看评价 "),a.orderBtn.look_comment_btn?(e(),t(j,{key:5,class:"bg-warning ml-[20rpx] h-[60rpx] leading-[60rpx] text-base text-white",onClick:h[6]||(h[6]=i((e=>q("/bundle/pages/evaluate_detail/index?order_goods_id="+a.orderGoodsId)),["stop"]))},{default:d((()=>[n(" 查看评价 ")])),_:1})):s("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-2eb0b780"]]);export{z as O};
