import{$ as e,a0 as a,d as t,W as l,b as o,a1 as s,a2 as r,a3 as u,e as n,f as i,o as d,c,w as p,r as m,h as f,n as g,j as x,g as _,k as h,P as v,a4 as b,a5 as y,a6 as w,a7 as k,a8 as j,q as V,J as C,t as $,m as S,i as U,a9 as L,aa as T,ab as B,a as W,X as F,Z as q,ac as z,ad as A,I,v as N,l as K,V as P,F as E,u as J,ae as M,af as Q,ag as R}from"./index-81cd8d96.js";import{_ as X}from"./page-meta.31474f74.js";import{_ as Z}from"./u-image.b1460259.js";import{_ as D}from"./u-checkbox.5fab566c.js";import{_ as G}from"./u-icon.1e505d03.js";import{a as H}from"./util.4309b5a4.js";import{_ as O}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as Y}from"./u-form-item.bb8ca0b6.js";import{_ as ee}from"./u-popup.0f1c5899.js";import{u as ae}from"./account.81e58239.js";import"./emitter.1571a5d9.js";const te=O(t({__name:"avatar-upload",props:{modelValue:{type:String},fileKey:{type:String,default:"uri"},size:{type:[String,Number],default:120},round:{type:[Boolean,String,Number],default:!1},border:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(t,{emit:V}){const C=t,$=l(),S=o((()=>{const t=H(C.size);return{width:t,height:t,borderRadius:(l=C.round,!0===l||!1===l||e(l)&&"[object Boolean]"==a(l)?C.round?"50%":"":H(C.round))};var l})),U=e=>{v({url:"/uni_modules/vk-uview-ui/components/u-avatar-cropper/u-avatar-cropper?destWidth=300&rectWidth=200&fileType=jpg"})};return s("uAvatarCropper",(e=>{(async e=>{b({title:"正在上传中..."});try{const a=await y(e,$.temToken);console.log("data",a),w(),V("update:modelValue",a[C.fileKey])}catch(a){w(),uni.$u.toast(a)}})(e)})),r((()=>{u("uAvatarCropper")})),(e,a)=>{const l=k,o=n(i("u-icon"),G),s=j;return d(),c(s,{class:"avatar-upload p-0 m-0 rounded",style:g(x(S)),"hover-class":"none","open-type":"chooseAvatar",onClick:U,onChooseavatar:U},{default:p((()=>[t.modelValue?(d(),c(l,{key:0,class:"w-full h-full",mode:"heightFix",src:t.modelValue},null,8,["src"])):m(e.$slots,"default",{key:1},(()=>[f("div",{style:g(x(S)),class:"border border-dotted border-light flex w-full h-full flex-col items-center justify-center text-muted text-xs box-border rounded"},[_(o,{name:"plus",size:36}),h(" 添加图片 ")],4)]),!0)])),_:3},8,["style"])}}}),[["__scopeId","data-v-de052895"]]),le=t({__name:"mplogin-popup",props:{show:{type:Boolean},logo:{type:String},title:{type:String}},emits:["update:show","update"],setup(e,{emit:a}){const t=e,l=o({get:()=>t.show,set(e){a("update:show",e)}}),s=V(),r=e=>{const{nickname:t}=e.detail.value;return s.value?t?void a("update",{avatar:s.value,nickname:t}):uni.$u.toast({title:"请输入昵称"}):uni.$u.toast({title:"请添加头像"})};return(a,t)=>{const o=k,u=S,m=U,f=n(i("avatar-upload"),te),g=n(i("u-form-item"),Y),v=L,b=j,y=T,w=n(i("u-popup"),ee);return d(),c(m,null,{default:p((()=>[_(w,{modelValue:x(l),"onUpdate:modelValue":t[2]||(t[2]=e=>C(l)?l.value=e:null),mode:"bottom","border-radius":"14","mask-close-able":!1},{default:p((()=>[_(m,{class:"h-[1000rpx] p-[40rpx]"},{default:p((()=>[_(m,{class:"flex items-center"},{default:p((()=>[_(o,{class:"w-[100rpx] h-[100rpx] rounded",mode:"heightFix",src:e.logo},null,8,["src"]),_(u,{class:"text-3xl ml-5 font-bold"},{default:p((()=>[h($(e.title),1)])),_:1})])),_:1}),_(m,{class:"mt-5 text-muted"},{default:p((()=>[h(" 建议使用您的微信头像和昵称，以便获得更好的体验 ")])),_:1}),_(m,{class:"mt-[30rpx]"},{default:p((()=>[_(y,{onSubmit:r},{default:p((()=>[_(g,{required:"",label:"头像",labelWidth:120},{default:p((()=>[_(m,{class:"flex-1"},{default:p((()=>[_(f,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e)},null,8,["modelValue"])])),_:1})])),_:1}),_(g,{required:"",label:"昵称",labelWidth:120},{default:p((()=>[_(v,{class:"flex-1 h-[60rpx]",name:"nickname",type:"nickname",placeholder:"请输入昵称"})])),_:1}),_(m,{class:"mt-[80rpx]"},{default:p((()=>[_(b,{class:"bg-primary rounded-full text-white text-lg h-[80rpx] leading-[80rpx]","hover-class":"none","form-type":"submit"},{default:p((()=>[h(" 确定 ")])),_:1})])),_:1}),_(m,{class:"flex justify-center mt-[60rpx]"},{default:p((()=>[_(m,{class:"text-muted",onClick:t[1]||(t[1]=e=>l.value=!1)},{default:p((()=>[h("暂不登录")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),oe=O(t({__name:"login",setup(e){const a=V(!0);a.value=B();const t=l(),s=W(),r=J(),u=V(!1),m=V(!1),f=V(),g=o((()=>1==s.config.third_auth)),y=o((()=>1==s.config.wechat_auth)),k=o((()=>1==s.config.coerce_mobile)),C=async e=>{const{token:a,mobile:l}=e;if(!l&&k.value)return t.temToken=a,v({url:"/pages/bind_mobile/index"}),void w();t.login(e.token),await t.getUser(),uni.$u.toast("登录成功");const o=M();if(o.length>1){const e=o[o.length-2];await r.navigateBack();const{onLoad:a,options:t}=e;a&&a(t)}else if(Q.get(R))try{r.redirectTo(Q.get(R))}finally{r.switchTab(Q.get(R))}else r.reLaunch("/pages/index/index");Q.remove(R)},S=e=>{v({url:e})},L=async e=>{await ae(e,{token:t.temToken}),m.value=!1,C(f.value)};return F((async e=>{if(t.isLogin)return void q({url:"/pages/index/index"});if(!a.value)return void z({url:"/pages/login_account/index?type="+(s.config.login_way[0]||1)});const{code:l}=e;if(l){b({title:"请稍后..."});try{const e=await A.authLogin(l);C(e)}catch(o){throw w(),new Error(o)}}else if(!g.value||!y.value)return void z({url:"/pages/login_account/index"})})),I((async()=>{t.isLogin&&q({url:"/pages/index/index"})})),(e,t)=>{const l=n(i("page-meta"),X),o=n(i("u-image"),Z),r=U,f=j,v=n(i("u-checkbox"),D),b=n(i("mplogin-popup"),le);return d(),N(E,null,[_(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),_(r,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[80rpx] box-border"},{default:p((()=>[_(r,null,{default:p((()=>[_(o,{src:x(s).config.shop_logo,mode:"widthFix",height:"160",width:"160","border-radius":"16rpx"},null,8,["src"])])),_:1}),_(r,{class:"mt-[100rpx] text-center"},{default:p((()=>[_(r,{class:"text-2xl font-bold"},{default:p((()=>[h($(x(s).config.shop_name),1)])),_:1}),_(r,{class:"text-muted mt-[30rpx]"},{default:p((()=>[h($(x(s).config.shop_abbrev),1)])),_:1})])),_:1}),_(r,{class:"mt-[140rpx] w-full"},{default:p((()=>[x(g)&&x(y)?(d(),c(r,{key:0},{default:p((()=>[_(f,{class:"bg-primary text-lg text-white leading-[80rpx] h-[80rpx] mb-[50rpx]",onClick:t[0]||(t[0]=e=>(async()=>{if(!u.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");a.value&&A.getUrl()})())},{default:p((()=>[h(" 用户一键登录 ")])),_:1})])),_:1})):K("v-if",!0),_(r,null,{default:p((()=>[_(r,{class:"text-center",onClick:t[1]||(t[1]=e=>S("/pages/login_account/index"))},{default:p((()=>[h(" 手机号登录 ")])),_:1})])),_:1})])),_:1}),_(r,{class:"footer"},{default:p((()=>[_(v,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=e=>u.value=e),shape:"circle","active-color":e.$theme.primaryColor},{default:p((()=>[_(r,{class:"text-xs flex"},{default:p((()=>[h(" 已阅读并同意 "),_(r,{class:"text-primary","hover-class":"none",onClick:t[2]||(t[2]=P((e=>S("/bundle/pages/service_explan/index?id=1")),["stop"]))},{default:p((()=>[h(" 《服务协议》 ")])),_:1}),h(" 和 "),_(r,{class:"text-primary","hover-class":"none",onClick:t[3]||(t[3]=P((e=>S("/bundle/pages/service_explan/index?id=2")),["stop"]))},{default:p((()=>[h(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1},8,["modelValue","active-color"])])),_:1}),_(b,{show:m.value,"onUpdate:show":t[5]||(t[5]=e=>m.value=e),logo:x(s).config.shop_logo,title:x(s).config.shop_name,onUpdate:L},null,8,["show","logo","title"])])),_:1})],64)}}}),[["__scopeId","data-v-15c11637"]]);export{oe as default};
