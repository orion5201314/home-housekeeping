import{d as e,aA as a,q as t,X as l,o as r,v as s,g as o,l as i,w as n,k as u,t as d,c as m,F as c,x as p,n as f,Z as _,aC as v,ay as y,e as x,f as w,i as g,a8 as b,m as h,aE as j}from"./index-81cd8d96.js";import{_ as k}from"./page-meta.31474f74.js";import{_ as C}from"./u-count-down.a6aaa69e.js";import{_ as $}from"./u-image.b1460259.js";import{_ as V,a as P}from"./u-radio-group.e2593039.js";import{_ as z}from"./u-popup.0f1c5899.js";import{u as A}from"./payment.ab5a4df2.js";import{_ as M}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.1e505d03.js";import"./emitter.1571a5d9.js";const U=M(e({__name:"order_pay",setup(e){const M=a(),{initPayWay:U,handlePayPrepay:W}=A(),D=t({from:"order",order_id:"",icon:"",order_amount:""}),E=t({cancel_time:"",order_amount:""}),L=t(),N=t(),S=t(!1),q=t("");function F(){const e=JSON.stringify({order_id:D.value.order_id,from:D.value.from});"order"==D.value.from&&_({url:`/bundle/pages/payment_result/payment_result?param=${e}`}),"recharge"==D.value.from&&_({url:"/bundle/pages/user_wallet/user_wallet?isPay=true"})}const I=async()=>{if(!(await y({title:"温馨提示",content:"确认支付吗？"})).cancel){if(2==L.value){if(navigator.userAgent.toLowerCase().match(/MicroMessenger/i))return void _({url:`/bundle/pages/toAlipay/toAlipay?order_id=${D.value.order_id}&from=${D.value.from}&pay_way=${L.value}&key=${M}`})}try{W({from:D.value.from,pay_way:L.value,order_id:D.value.order_id})}catch(e){console.log(e)}}};l((async e=>{(null==e?void 0:e.order_amount)&&(D.value.order_amount=null==e?void 0:e.order_amount,L.value=2),D.value.order_id=e.order_id,D.value.from=e.from,(async()=>{E.value=await U({...D.value}),N.value=1e3*(E.value.cancel_time-Date.now()/1e3);const e=E.value.lists.find((e=>e.is_default))||E.value.lists[0];L.value=null==e?void 0:e.pay_way})()}));const J=async e=>{await y({title:"温馨提示",showCancel:!1,content:"当前订单支付时间已过，请重新下单",success:()=>{_({url:"/pages/index/index"})}})};return(e,a)=>{const t=x(w("page-meta"),k),l=g,_=x(w("u-count-down"),C),y=x(w("u-image"),$),A=x(w("u-radio"),V),M=j,U=x(w("u-radio-group"),P),W=b,O=h,Q=x(w("u-popup"),z);return r(),s(c,null,[o(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),i(' <u-navbar title="订单支付" @leftClick="handleleft"> </u-navbar> '),o(l,{class:"box flex justify-center items-center flex-col"},{default:n((()=>[o(l,{class:"box-text"},{default:n((()=>[u("￥"+d(E.value.order_amount),1)])),_:1}),N.value>=0&&"order"===D.value.from?(r(),m(l,{key:0,class:"box-time flex"},{default:n((()=>[u("支付剩余时间"),o(_,{timestamp:N.value,onEnd:J,format:"mm:ss","font-size":26,"separator-size":26},null,8,["timestamp"])])),_:1})):i("v-if",!0)])),_:1}),o(l,{class:"pay-box"},{default:n((()=>[i(' <radio-group>\n            <view\n                v-for="item in payData.lists"\n                :key="item.id"\n                class="item"\n                @click="selectPayWay(item.pay_way)"\n            >\n                <label>\n                    <view class="flex justify-between items-center">\n                        <view class="flex items-center py-[20rpx] justify-between w-full">\n                            <view class="flex items-center">\n                                <u-image :src="item.image" width="48" height="48" />\n                                <view class="pl-[20rpx]">\n                                    <view class="text-[28rpx] text-[#333]">{{ item.name }}</view>\n                                    <view class="pt-1 text-[24rpx] text-muted">\n                                        {{ item.extra }}\n                                    </view>\n                                </view>\n                            </view>\n                            <view>\n                                <radio\n                                    :color="$theme.primaryColor"\n                                    :value="item.pay_way"\n                                    :checked="item.pay_way === payWay"\n                                />\n                            </view>\n                        </view>\n                    </view>\n                </label>\n            </view>\n        </radio-group> '),(r(),m(U,{modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),key:L.value,class:"w-full","active-color":e.$theme.primaryColor},{default:n((()=>[(r(!0),s(c,null,p(E.value.lists,(e=>(r(),m(l,{key:e.id,class:"item w-full",onClick:a=>{return t=e.pay_way,void(L.value=t);var t}},{default:n((()=>[o(M,null,{default:n((()=>[o(l,{class:"flex justify-between items-center"},{default:n((()=>[o(l,{class:"flex items-center py-[20rpx] justify-between w-full"},{default:n((()=>[o(l,{class:"flex items-center"},{default:n((()=>[o(y,{src:e.image,width:"48",height:"48"},null,8,["src"]),o(l,{class:"pl-[20rpx]"},{default:n((()=>[o(l,{class:"text-[28rpx] text-[#333]"},{default:n((()=>[u(d(e.name),1)])),_:2},1024),o(l,{class:"pt-1 text-[24rpx] text-muted"},{default:n((()=>[u(d(e.extra),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(l,null,{default:n((()=>[o(A,{name:e.pay_way},null,8,["name"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","active-color"]))])),_:1}),o(l,{class:"bottom_box w-full p-[20rpx]"},{default:n((()=>[o(W,{class:"pay_btn",onClick:I},{default:n((()=>[u("立即支付")])),_:1})])),_:1}),o(Q,{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=e=>S.value=e),mode:"bottom",height:"600rpx","safe-area-inset-bottom":"","border-radius":"20",closeable:"",onClose:F},{default:n((()=>[o(l,{style:{padding:"60rpx 30rpx",display:"flex","justify-content":"center","align-items":"center","flex-direction":"column"}},{default:n((()=>[o(l,{style:{"font-size":"50rpx",margin:"10rpx 0 20rpx"}},{default:n((()=>[u("￥"+d(E.value.order_amount),1)])),_:1}),o(l,{class:"flex row-between m-t-50",style:{width:"100%","justify-content":"space-between","font-weight":"bold"}},{default:n((()=>[o(O,{class:"bold"},{default:n((()=>[u("支付方式")])),_:1}),o(O,{class:"bold"},{default:n((()=>[u("支付宝")])),_:1})])),_:1}),o(l,{class:"p-20 m-t-50 m-b-50",style:{width:"100%","background-color":"#9e9e9e40",padding:"15rpx 15rpx",margin:"50rpx 0"}},{default:n((()=>[u("请复制链接,粘贴至浏览器并支付")])),_:1}),o(W,{onClick:a[1]||(a[1]=e=>(console.log(q.value),void v({data:q.value}))),style:f({"border-radius":"12rpx",width:"100%",height:"80rpx","line-height":"80rpx","font-size":"28rpx",color:"white","background-color":e.$theme.primaryColor})},{default:n((()=>[u("复制链接")])),_:1},8,["style"])])),_:1})])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-10366890"]]);export{U as default};
