import{d as e,q as a,a as l,W as s,G as t,D as o,b as r,s as u,X as i,o as n,v as d,g as c,w as p,k as m,t as f,j as x,c as b,l as g,V as v,F as _,u as y,a4 as h,a6 as w,P as V,ae as k,af as j,ag as C,ah as $,ai as U,e as L,f as G,i as T,m as I,a8 as N}from"./index-81cd8d96.js";import{_ as S}from"./page-meta.31474f74.js";import{_ as q}from"./u-tabs.8ea32a3d.js";import{_ as B}from"./u-input.241f466f.js";import{_ as D}from"./u-verification-code.459d0037.js";import{_ as F}from"./u-checkbox.5fab566c.js";import{l as M}from"./account.81e58239.js";import{_ as O}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-badge.d618a77d.js";import"./u-icon.1e505d03.js";import"./emitter.1571a5d9.js";const P=O(e({__name:"index",setup(e){const O=a(!1),P=l(),R=s(),W=a(0),X=a([{name:"账号登录",way:1},{name:"验证码登录",way:2}]),z=t({scene:X.value[W.value].way,mobile:"",password:"",code:""}),A=o(),E=a("获取验证码"),H=r((()=>1==P.config.coerce_mobile)),J=y(),K=async e=>{const{token:a,mobile:l}=e;if(!l&&H.value)return R.temToken=a,V({url:"/pages/bind_mobile/index"}),void w();R.login(e.token),await R.getUser(),uni.$u.toast("登录成功");const s=k();if(s.length>1){const e=s[s.length-2];await J.navigateBack();const{onLoad:a,options:l}=e;a&&a(l)}else if(j.get(C))try{J.redirectTo(j.get(C))}finally{J.switchTab(j.get(C))}else J.reLaunch("/pages/index/index");j.remove(C)},Q=e=>{E.value=e},Y=async()=>{var e,a;if(!z.mobile)return uni.$u.toast("请输入手机号码");(null==(e=A.value)?void 0:e.canGetCode)&&(await $({scene:U.LOGIN,mobile:z.mobile}),uni.$u.toast("发送成功"),null==(a=A.value)||a.start())},Z=e=>{V({url:e})};return u((()=>W.value),(e=>{z.scene=X.value[W.value].way}),{immediate:!0}),i((e=>{X.value=X.value.filter((function(e){return P.config.login_way.includes(e.way.toString())}))})),(e,a)=>{const l=L(G("page-meta"),S),s=T,t=L(G("u-tabs"),q),o=L(G("u-input"),B),r=I,u=L(G("u-verification-code"),D),i=N,y=L(G("u-checkbox"),F);return n(),d(_,null,[c(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),c(s,{class:"register bg-white min-h-full flex flex-col items-center px-[40rpx] pt-[40rpx] box-border"},{default:p((()=>[c(s,{class:"w-full"},{default:p((()=>[c(s,{class:"pt-[40rpx] pb-[70rpx] font-bold text-3xl pl-[30rpx]"},{default:p((()=>[m(f(x(P).config.shop_name),1)])),_:1}),c(s,{class:"mb-[60rpx]"},{default:p((()=>[c(t,{list:X.value,"active-color":e.$theme.primaryColor,"is-scroll":!0,modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),"bar-height":"10","bar-width":"80","bar-style":{bottom:"-4rpx"}},null,8,["list","active-color","modelValue"])])),_:1}),c(s,null,{default:p((()=>[c(s,{class:"flex mb-[40rpx]"},{default:p((()=>[c(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 30rpx"},modelValue:z.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>z.mobile=e),border:!1,placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),1==X.value[W.value].way?(n(),b(s,{key:0,class:"flex mb-[40rpx] code-input"},{default:p((()=>[c(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 150rpx 10rpx 30rpx"},type:"password",modelValue:z.password,"onUpdate:modelValue":a[2]||(a[2]=e=>z.password=e),placeholder:"请输入密码",border:!1},null,8,["modelValue"]),c(s,{class:"code",onClick:a[3]||(a[3]=e=>Z("/pages/forget_pwd/forget_pwd?mobile="+z.mobile))},{default:p((()=>[c(r,null,{default:p((()=>[m("忘记？")])),_:1})])),_:1})])),_:1})):g("v-if",!0),2==X.value[W.value].way?(n(),b(s,{key:1,class:"flex mb-[40rpx] code-input"},{default:p((()=>[c(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 200rpx 10rpx 30rpx"},modelValue:z.code,"onUpdate:modelValue":a[4]||(a[4]=e=>z.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),c(s,{class:"code",onClick:Y},{default:p((()=>[c(u,{ref_key:"uCodeRef",ref:A,seconds:60,onChange:Q,"change-text":"x秒"},null,512),c(r,null,{default:p((()=>[m(f(E.value),1)])),_:1})])),_:1})])),_:1})):g("v-if",!0)])),_:1}),c(s,{class:"mt-[60rpx]"},{default:p((()=>[c(i,{class:"bg-primary text-lg text-white leading-[80rpx] h-[80rpx] mb-[50rpx]",onClick:a[5]||(a[5]=e=>(async()=>{if(console.log(z.scene),!O.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");if(!z.mobile)return uni.$u.toast("请输入手机号码");if(1==z.scene&&!z.password)return uni.$u.toast("请输入密码");if(2==z.scene&&!z.code)return uni.$u.toast("请输入验证码");h({title:"请稍后......"});try{const e=await M(z);K(e)}catch(e){w(),uni.$u.toast(e)}})())},{default:p((()=>[m(" 登录 ")])),_:1}),c(s,{class:"text-center mt-[40rpx]"},{default:p((()=>[c(r,{onClick:a[6]||(a[6]=e=>Z("/pages/register/register"))},{default:p((()=>[m("注册")])),_:1})])),_:1})])),_:1})])),_:1}),c(s,{class:"footer"},{default:p((()=>[c(y,{modelValue:O.value,"onUpdate:modelValue":a[9]||(a[9]=e=>O.value=e),shape:"circle","active-color":e.$theme.primaryColor},{default:p((()=>[c(s,{class:"text-xs flex"},{default:p((()=>[m(" 已阅读并同意 "),c(s,{class:"text-primary","hover-class":"none",onClick:a[7]||(a[7]=v((e=>Z("/bundle/pages/service_explan/index?id=1")),["stop"]))},{default:p((()=>[m(" 《服务协议》 ")])),_:1}),m(" 和 "),c(s,{class:"text-primary","hover-class":"none",onClick:a[8]||(a[8]=v((e=>Z("/bundle/pages/service_explan/index?id=2")),["stop"]))},{default:p((()=>[m(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1},8,["modelValue","active-color"])])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-69e4f1cb"]]);export{P as default};
