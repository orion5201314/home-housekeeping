import{f as e,j as a,u as l,g as s,s as t,k as o,l as r,m as u,ab as n,ad as d,o as i,p as c,e as p,w as m,t as f,x,q as g,c as b,b as _,T as v,F as y,ak as h,z as w,D as k,N as V,al as C,am as j,an as $,ao as L,I as U,r as T,d as q,i as D,K as F,J as I}from"./index.ceec0680.js";import{_ as S}from"./page-meta.7314eaca.js";import{_ as z}from"./u-tabs.893c4858.js";import{_ as B}from"./u-input.39fcd58d.js";import{_ as G}from"./u-verification-code.87e7c6dd.js";import{_ as J}from"./u-checkbox.76f7936e.js";import{l as K}from"./account.143116b5.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./u-badge.5f9f6552.js";import"./u-icon.0c807563.js";import"./emitter.5b880544.js";var N=M(e({__name:"login",setup(e){const M=a(!1),N=l(),R=s(),Y=t(),Z=a("获取验证码"),A=h(),E=a(0),H=[{name:"账号登录",way:1},{name:"验证码登录",way:2}],O=o({scene:H[E.value].way,mobile:"",password:"",code:""}),P=e=>{E.value=e},Q=async()=>{if(!M.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");if(!O.mobile)return uni.$u.toast("请输入手机号");if(!O.password&&1==O.scene)return uni.$u.toast("请输入密码");if(!O.code&&2==O.scene)return uni.$u.toast("请输入验证码");w({title:"请稍后..."});try{const e=await K(O);W(e)}catch(e){k(),uni.$u.toast(e)}},W=async e=>{const{token:a}=e;R.login(a),R.getUser(),k();const l=V();if(l.length>1){const e=l[l.length-2];await A.navigateBack();const{onLoad:a,options:s}=e;a&&a(s)}else if(C.get(j))try{A.redirectTo(C.get(j))}finally{A.switchTab(C.get(j))}else A.reLaunch("/pages/index/index");C.remove(j)},X=e=>{Z.value=e},ee=async()=>{var e,a;if(!O.mobile)return uni.$u.toast("请输入手机号码");(null==(e=Y.value)?void 0:e.canGetCode)&&(await $({scene:L.YZMDLSF,mobile:O.mobile}),uni.$u.toast("发送成功"),null==(a=Y.value)||a.start())},ae=e=>{U({url:e})};return r((()=>E.value),(e=>{O.scene=H[E.value].way}),{immediate:!0}),u((async e=>{R.isLogin&&n({url:"/pages/index/index"})})),d((async()=>{R.isLogin&&n({url:"/pages/index/index"})})),(e,a)=>{const l=T(q("page-meta"),S),s=D,t=T(q("u-tabs"),z),o=T(q("u-input"),B),r=F,u=T(q("u-verification-code"),G),n=I,d=T(q("u-checkbox"),J);return i(),c(y,null,[p(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),p(s,{class:"register bg-white min-h-full flex flex-col items-center px-[40rpx] pt-[40rpx] box-border"},{default:m((()=>[p(s,{class:"w-full"},{default:m((()=>[p(s,{class:"pt-[40rpx] pb-[70rpx] font-bold text-4xl"},{default:m((()=>[f(x(g(N).config.staff_name),1)])),_:1}),p(s,{class:"mb-[60rpx]"},{default:m((()=>[p(t,{list:H,"active-color":e.$theme.primaryColor,"is-scroll":!1,modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),"bar-height":"12","bar-width":"80","bar-style":{bottom:"-4rpx"},onChange:P},null,8,["active-color","modelValue"])])),_:1}),p(s,null,{default:m((()=>[p(s,{class:"flex mb-[40rpx]"},{default:m((()=>[p(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 30rpx"},modelValue:O.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>O.mobile=e),border:!1,placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),0==E.value?(i(),b(s,{key:0,class:"flex mb-[40rpx] code-input"},{default:m((()=>[p(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 150rpx 10rpx 30rpx"},type:"password",modelValue:O.password,"onUpdate:modelValue":a[2]||(a[2]=e=>O.password=e),placeholder:"请输入密码",border:!1},null,8,["modelValue"]),p(s,{class:"code",onClick:a[3]||(a[3]=e=>ae("/pages/forget_pwd/forget_pwd"))},{default:m((()=>[p(r,null,{default:m((()=>[f("忘记？")])),_:1})])),_:1})])),_:1})):_("v-if",!0),1==E.value?(i(),b(s,{key:1,class:"flex mb-[40rpx] code-input"},{default:m((()=>[p(o,{class:"flex-1 bg-[#edf1f3]",style:{"border-radius":"100rpx",padding:"10rpx 200rpx 10rpx 30rpx"},modelValue:O.code,"onUpdate:modelValue":a[4]||(a[4]=e=>O.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),p(s,{class:"code",onClick:ee},{default:m((()=>[p(u,{ref_key:"uCodeRef",ref:Y,seconds:60,onChange:X,"change-text":"x秒"},null,512),p(r,null,{default:m((()=>[f(x(Z.value),1)])),_:1})])),_:1})])),_:1})):_("v-if",!0)])),_:1}),p(s,{class:"mt-[60rpx]"},{default:m((()=>[_(' <u-button class="text-white" shape="square" :custom-style="{\'background-color\':$theme.primaryColor}" @click="accountLogin"> 登录 </u-button> '),p(n,{class:"bg-primary text-lg text-white",onClick:Q},{default:m((()=>[f(" 登录 ")])),_:1}),p(s,{class:"text-center mt-[40rpx]"},{default:m((()=>[p(r,{onClick:a[5]||(a[5]=e=>ae("/pages/register/register"))},{default:m((()=>[f("注册")])),_:1})])),_:1})])),_:1})])),_:1}),p(s,{class:"footer"},{default:m((()=>[p(d,{modelValue:M.value,"onUpdate:modelValue":a[8]||(a[8]=e=>M.value=e),shape:"circle","active-color":e.$theme.primaryColor},{default:m((()=>[p(s,{class:"text-xs flex"},{default:m((()=>[f(" 我已阅读并同意 "),p(s,{class:"text-primary","hover-class":"none",onClick:a[6]||(a[6]=v((e=>ae("/pages/agreement/agreement?id=3")),["stop"]))},{default:m((()=>[f(" 《服务协议》 ")])),_:1}),f(" 与 "),p(s,{class:"text-primary","hover-class":"none",onClick:a[7]||(a[7]=v((e=>ae("/pages/agreement/agreement?id=4")),["stop"]))},{default:m((()=>[f(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1},8,["modelValue","active-color"])])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-2ef7dad1"]]);export{N as default};
