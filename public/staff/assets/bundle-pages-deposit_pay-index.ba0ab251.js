import{bh as e,bi as a,bj as t,bk as o,bl as l,ab as r,f as s,j as n,g as i,h as u,b4 as c,m as d,o as p,p as f,e as m,w as y,b as _,q as g,t as w,c as x,F as b,y as v,x as h,ae as P,z as k,bm as S,D as $,av as j,r as I,d as V,i as C,K as A,J as T}from"./index.ceec0680.js";import{_ as z}from"./page-meta.7314eaca.js";import{_ as M}from"./u-input.39fcd58d.js";import{_ as N}from"./u-image.d192f048.js";import{_ as O,a as q}from"./u-radio-group.beb42f9b.js";import{_ as W}from"./u-popup.4ec2fed5.js";import{P as F}from"./index.a4984710.js";import{_ as J}from"./plugin-vue_export-helper.21dcd24c.js";import"./u-icon.0c807563.js";import"./emitter.5b880544.js";function U(a){return console.log("options:",a),new Promise(((t,o)=>{new Promise(((a,t)=>{e.ready((()=>{a("success"),console.log("111222")}))})).then((()=>{console.log("微信支付",a),e.chooseWXPay({timestamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:e=>{t(e)},cancel:e=>{o(e)},fail:e=>{o(e)}})})).catch((e=>{console.log(e)}))}))}function H(){const e=async(e,t)=>{try{switch(t.pay_way){case 1:await(async e=>{await a({MP_WEIXIN:()=>new Promise(((a,t)=>{console.log(e,"weixin"),uni.requestPayment({provider:"wxpay",timeStamp:null==e?void 0:e.timeStamp,nonceStr:null==e?void 0:e.nonceStr,package:null==e?void 0:e.package,signType:null==e?void 0:e.signType,paySign:null==e?void 0:e.paySign,success:e=>a(e),fail:e=>t(e)})})),OA_WEIXIN:()=>U(e),H5:()=>new Promise(((a,t)=>{window.open(e,"_self"),a()})),APP:()=>new Promise(((a,t)=>{uni.requestPayment({provider:"wxpay",orderInfo:e,success:e=>a(e),cancel:e=>t(e),fail:e=>t(e)})}))})})(e.config);break;case 2:await(async e=>{await a({H5:()=>new Promise(((a,t)=>{const o=window.open("","_self");o.document.body.innerHTML=e,o.document.forms[0].submit(),a()})),APP:()=>new Promise(((a,t)=>{uni.requestPayment({provider:"alipay",orderInfo:e,success:e=>a("success"),cancel:e=>t("fail"),fail:e=>t("fail")})})),MP_TOUTIAO:()=>(console.log(e),new Promise(((a,t)=>{uni.requestPayment({provider:"alipay",orderInfo:e,service:1,success:e=>a(e),cancel:e=>t(e),fail:e=>t(e)})})))})})(e.config);break;default:uni.$u.toast("支付异常")}const o=JSON.stringify({order_id:t.order_id,from:t.from});if("deposit"===t.from)return r({url:"/bundle/pages/deposit/index?isPay=true"});r({url:`/bundle/pages/payment_result/payment_result?param=${o}`})}catch(o){if("order"===t.from&&r({url:"/pages/order/index"}),0==Number(t.order_amount))return uni.$u.toast("下单成功");uni.$u.toast("支付取消")}};return{initPayWay:async e=>{try{return await t({from:e.from||"order",scene:o()})}catch(a){console.log("获取支付方式",a)}},handlePayPrepay:async a=>{try{const t=await l({from:a.from||"order",pay_way:a.pay_way,order_id:a.order_id}),o=JSON.stringify({order_id:a.order_id,from:a.from});3!==a.pay_way?e(t,a):(r({url:`/bundle/pages/payment_result/payment_result?param=${o}`}),uni.$u.toast("支付成功"))}catch(t){uni.$u.toast(t)}},handlePay:e}}var X=J(s({__name:"index",setup(e){const{initPayWay:a,handlePayPrepay:t}=H(),o=n({pay_way:"",amount:""}),l=i(),s=u((()=>l.userInfo)),J=n([]),U=n(""),X=n(!1),E=c(),L=n(0),D=async()=>o.value.amount?o.value.pay_way?void P({title:"温馨提示",content:"是否确认下单支付？",success:function(e){e.confirm&&K()}}):uni.$u.toast("请选择支付方式"):uni.$u.toast("请输入支付金额"),K=async()=>{k({title:"订单提交中...",mask:!0});try{const e=await S(o.value);if(L.value=e.order_id,2==o.value.pay_way){if($(),navigator.userAgent.toLowerCase().match(/MicroMessenger/i))return void r({url:`/bundle/pages/toAlipay/toAlipay?order_id=${e.order_id}&from=${e.type}&pay_way=${o.value.pay_way}&key=${E}`})}t({from:e.type,pay_way:o.value.pay_way,order_id:e.order_id})}catch(e){console.log("下单",e)}};function B(){const e=JSON.stringify({order_id:L.value,from:"deposit"});r({url:`/bundle/pages/payment_result/payment_result?param=${e}`})}return d((e=>{o.value.amount=e.order_amount||0,(async()=>{var e;J.value=await a({from:"deposit"});const t=J.value.filter((e=>1===e.is_default));o.value.pay_way=null==(e=t[0])?void 0:e.pay_way})()})),(e,a)=>{const t=I(V("page-meta"),z),l=C,r=A,n=I(V("u-input"),M),i=I(V("u-image"),N),u=I(V("u-radio"),O),c=I(V("u-radio-group"),q),d=T,P=I(V("u-popup"),W);return p(),f(b,null,[m(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),m(l,{class:"order_detail"},{default:y((()=>[_(" Main Start "),m(l,{class:"top text-center"},{default:y((()=>[m(F,{price:g(s).staff_deposit,priceFontSize:"60rpx",priceIconFontSize:"26rpx",priceColor:"#ffffff"},null,8,["price"]),m(l,{class:"text-sm text-[#ffffffd1]"},{default:y((()=>[w("当前保证金（元）")])),_:1})])),_:1}),m(l,{class:"info"},{default:y((()=>[m(l,{class:"mb-[40rpx]"},{default:y((()=>[m(l,{class:"font-bold text-1xl"},{default:y((()=>[w("缴纳金额")])),_:1}),m(l,{class:"input u-flex mt-[20rpx] mb-[20rpx]"},{default:y((()=>[m(r,{class:"font-bold text-[36rpx]"},{default:y((()=>[w("￥")])),_:1}),m(n,{class:"w-full ml-[10rpx]",modelValue:o.value.amount,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value.amount=e),clearable:!1,placeholder:"输入缴纳金额"},null,8,["modelValue"])])),_:1})])),_:1}),m(l,null,{default:y((()=>[m(l,{class:"font-bold text-1xl"},{default:y((()=>[w("支付方式")])),_:1}),(p(),x(c,{modelValue:o.value.pay_way,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.pay_way=e),key:o.value.pay_way,class:"w-full","active-color":e.$theme.primaryColor},{default:y((()=>[(p(!0),f(b,null,v(J.value,(e=>(p(),x(l,{key:e.pay_way,class:"u-flex justify-between account w-full",onClick:a=>{return t=e.pay_way,o.value.pay_way=t,void console.log(o.value.pay_way);var t}},{default:y((()=>[m(l,{class:"u-flex"},{default:y((()=>[m(l,null,{default:y((()=>[m(i,{width:"40rpx",height:"40rpx",src:e.image},null,8,["src"])])),_:2},1024),m(l,{class:"font-bold text-1xl ml-[20rpx]"},{default:y((()=>[w(h(e.name),1)])),_:2},1024)])),_:2},1024),m(l,null,{default:y((()=>[m(u,{name:e.pay_way},null,8,["name"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","active-color"]))])),_:1})])),_:1}),m(l,{class:"footer"},{default:y((()=>[m(d,{class:"bg-primary text-lg text-white",onClick:D},{default:y((()=>[w(" 充值 ")])),_:1}),_(' <u-button type="primary" size="medium" @click="recharge">充值</u-button> ')])),_:1}),_(" 支付宝支付弹窗 "),m(P,{modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=e=>X.value=e),mode:"bottom",height:"600rpx","safe-area-inset-bottom":"","border-radius":"20",closeable:"",onClose:B},{default:y((()=>[m(l,{style:{padding:"60rpx 30rpx",display:"flex","justify-content":"center","align-items":"center","flex-direction":"column"}},{default:y((()=>[m(l,{style:{"font-size":"50rpx",margin:"10rpx 0 20rpx"}},{default:y((()=>[w("￥"+h(o.value.amount),1)])),_:1}),m(l,{class:"flex row-between m-t-50",style:{width:"100%","justify-content":"space-between","font-weight":"bold"}},{default:y((()=>[m(r,{class:"bold"},{default:y((()=>[w("支付方式")])),_:1}),m(r,{class:"bold"},{default:y((()=>[w("支付宝")])),_:1})])),_:1}),m(l,{class:"p-20 m-t-50 m-b-50",style:{width:"100%","background-color":"#9e9e9e40",padding:"15rpx 15rpx",margin:"50rpx 0"}},{default:y((()=>[w("请复制链接,粘贴至浏览器并支付")])),_:1}),m(d,{onClick:a[2]||(a[2]=e=>{j({data:U.value})}),style:{"border-radius":"12rpx",width:"100%",height:"80rpx","line-height":"80rpx","font-size":"28rpx",color:"white","background-color":"#F36161"}},{default:y((()=>[w("复制链接")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-5691ce43"]]);export{X as default};
