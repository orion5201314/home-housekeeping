import{Z as S}from"./element-plus.c171b4f3.js";import{l as C,u as T,m as b,n as w,o as v,p as E,f as k,q as A,s as L}from"./index.881dcebb.js";import{d as $,b as M,o as q,c as j,T as x,$ as I,u as P,j as R,r as D,Y as V}from"./@vue.dfea2d30.js";import{v as B}from"./@vueuse.29b489e3.js";const G={class:"area-select"},U=$({__name:"index",props:{province:{default:null},city:{default:null},district:{default:null},width:{default:"340px"},checkStrictly:{type:Boolean,default:!0},data:{default:C}},emits:["update:province","update:city","update:district"],setup(a,{emit:o}){const l=a,c={checkStrictly:!0},s=M({get:()=>[l.province,l.city,l.district],set:u=>{o("update:province",u[0]),o("update:city",u[1]),o("update:district",u[2])}});return(u,t)=>{const d=S;return q(),j("div",G,[x(d,{style:I({width:a.width}),modelValue:P(s),"onUpdate:modelValue":t[0]||(t[0]=p=>R(s)?s.value=p:null),options:l.data,props:c},null,8,["style","modelValue","options"])])}}}),K=a=>new Promise((o,l)=>{const c=document.getElementById(a);if(c)return o(c);try{const t=document.createElement("script");t.setAttribute("id",a),t.setAttribute("src",a),document.body.append(t),("onload"in t?s:u)(t).then(()=>o(t)).catch(()=>l())}catch(t){l(t)}function s(t){return new Promise((d,p)=>{t.onload=function(){this.onerror=this.onload=null,d(t)},t.onerror=function(){this.onerror=this.onload=null,p()}})}function u(t){return new Promise((d,p)=>{t.onreadystatechange=function(){(this.readyState==="loaded"||this.readyState==="complete")&&(this.onreadystatechange=null,d(t))}})}}),g=T(),h=M(()=>g.config);function Y(){let a=null,o=null,l=null;const c=D(h.value.tencent_map_key),s=V({province_id:"",city_id:"",district_id:"",address:"",latitude:"",longitude:""}),u=B((r,i)=>{const e=`https://map.qq.com/api/gljs?v=1.exp&key=${c.value}`;K(e).then(()=>t(r,i))},2e3),t=(r,i)=>{o=window.TMap;const e=o.LatLng,m=new e(r,i);new o.Map("container",{center:m}).destroy(),a=new o.Map("container",{center:m}),l=new o.MultiMarker({map:a,styles:{myStyle:new o.MarkerStyle({anchor:{x:17,y:34}})},geometries:[{id:"1",styleId:"myStyle",position:m}]}),a.on("click",n=>{const{lat:y,lng:_}=n.latLng;l.updateGeometries([{styleId:"myStyle",id:"1",position:new o.LatLng(y,_)}]),p(y,_)})},d=async(r,i,e,m)=>{try{const n=b(r,i,e),y=await w("https://apis.map.qq.com/ws/geocoder/v1/",{key:c.value,address:`${n==null?void 0:n.province}, ${n==null?void 0:n.city}, ${n==null?void 0:n.district}, ${m}`,output:"jsonp"});if(y.status===0){const{lat:_,lng:f}=y.result.location;u(_,f),a==null||a.setCenter({lat:_,lng:f})}else{if((await v(y)).result===!1){const f=await E({is_delete:!0});if(f.tencent_map_key){c.value=f.tencent_map_key,h.value.tencent_map_key=c.value,g.setConfig(h.value),await d(r,i,e,m);return}}k.msgError(y.message)}}catch(n){k.msgError(n)}},p=async(r,i)=>{try{const e=await w("https://apis.map.qq.com/ws/geocoder/v1/",{key:c.value,location:`${r},${i}`,output:"jsonp"});if(e.status===0)s.province_id=A(e.result.address_component.province),e.result.address_component.city=="\u5317\u4EAC\u5E02"||e.result.address_component.city=="\u5929\u6D25\u5E02"||e.result.address_component.city=="\u4E0A\u6D77\u5E02"||e.result.address_component.city=="\u91CD\u5E86\u5E02"?s.city_id=L(s.province_id,e.result.address_component.city):s.city_id=e.result.ad_info.city_code.substring(3,9),s.district_id=Number(e.result.ad_info.adcode),s.address=e.result.formatted_addresses.recommend,s.latitude=r,s.longitude=i;else{if((await v(e)).result===!1){const n=await E({is_delete:!0});if(n.tencent_map_key){c.value=n.tencent_map_key,h.value.tencent_map_key=c.value,g.setConfig(h.value),await p(r,i),await u(r,i);return}}k.msgError(e.message)}}catch(e){k.msgError(e)}};return{obj:s,loadTencentMapScript:u,addressGeocoder:d}}export{U as _,Y as u};
